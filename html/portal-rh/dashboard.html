<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal do Colaborador - BoraRangar</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen">
    
    <div id="app-content" class="hidden">
        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto p-4 flex flex-col sm:flex-row justify-between items-center text-center sm:text-left gap-4 sm:gap-0">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">Portal do Colaborador</h1>
                    <p id="welcome-message" class="text-sm text-slate-600"></p>
                </div>
                <a href="logout.php" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg w-full sm:w-auto">Sair</a>
            </div>
        </header>
        <main class="max-w-7xl mx-auto p-4 md:p-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6"> 
                
                <a id="link-meus-vales" href="meus-vales.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-purple-100 p-3 sm:p-4 rounded-full mb-4">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Meus Vales</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Consulte seus pagamentos.</p>
                </a>

                <a id="link-minhas-entregas" href="minhas-entregas.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-lime-100 p-3 sm:p-4 rounded-full mb-4">
                         <svg class="w-6 h-6 sm:w-8 sm:h-8 text-lime-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"></path>
                        </svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Minhas Entregas</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Consulte suas corridas.</p>
                </a>

                <a id="link-rh-gerente" href="rh-painel.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-blue-100 p-3 sm:p-4 rounded-full mb-4">
                         <svg class="w-6 h-6 sm:w-8 sm:h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Gestão de RH</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Equipe, vales e pagamentos.</p>
                </a>
                
            </div>
        </main>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- SCRIPT PARA O NOVO PORTAL-RH ---

        const appContent = document.getElementById('app-content');
        const welcomeMessage = document.getElementById('welcome-message');
        
        // --- Nossos 3 grupos de links ---
        const linkGerente = document.getElementById('link-rh-gerente');
        const linkFuncionarioVales = document.getElementById('link-meus-vales');
        const linkEntregadorEntregas = document.getElementById('link-minhas-entregas');

        // Esconde TODOS os links por padrão
        if(linkGerente) linkGerente.classList.add('hidden');
        if(linkFuncionarioVales) linkFuncionarioVales.classList.add('hidden');
        if(linkEntregadorEntregas) linkEntregadorEntregas.classList.add('hidden');

        
        function initializeApp(userName, userRole) {
            appContent.classList.remove('hidden');
            welcomeMessage.textContent = `Bem-vindo(a), ${userName} (${userRole})!`;

            // --- Lógica de Permissões (Suas Regras) ---
            
            // Regra 1: Gerente/Admin vê o link de Gestão de RH
            if (userRole === 'admin' || userRole === 'gerente') {
                if(linkGerente) linkGerente.classList.remove('hidden');
            } 
            // Regra 2: Entregador vê "Minhas Entregas" e "Meus Vales"
            else if (userRole === 'entregador') {
                if(linkEntregadorEntregas) linkEntregadorEntregas.classList.remove('hidden');
                if(linkFuncionarioVales) linkFuncionarioVales.classList.remove('hidden'); 
            }
            // Regra 3: Caixa/Funcionário vê SÓ "Meus Vales"
            else { 
                if(linkFuncionarioVales) linkFuncionarioVales.classList.remove('hidden'); 
            }
        }
        
        async function checkSession() {
             try {
                // A API de login (usuario_api) é a mesma, ela nos dá a sessão
                const response = await fetch('/usuario_api.php', {credentials: 'include'});
                
                if (response.ok) {
                    const users = await response.json();
                    
                    if (Array.isArray(users) && users.length > 0 && users[0].nome && users[0].role) { 
                        initializeApp(users[0].nome, users[0].role);
                    } else {
                        // Se não tem sessão, chuta pro login do portal
                        window.location.href = '/portal-rh/index.html';
                    }
                } else {
                    window.location.href = '/portal-rh/index.html'; 
                }
            } catch(e) {
                console.error("Erro na verificação de sessão", e);
                window.location.href = '/portal-rh/index.html'; 
            }
        }
        
        checkSession();
    });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle - BoraRangar</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen">
    
    <div id="app-content" class="hidden">
        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto p-4 flex flex-col sm:flex-row justify-between items-center text-center sm:text-left gap-4 sm:gap-0">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">Painel de Operações</h1>
                    <p id="welcome-message" class="text-sm text-slate-600"></p>
                </div>
                <a href="/logout.php" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg w-full sm:w-auto">Sair</a>
            </div>
        </header>
        <main class="max-w-7xl mx-auto p-4 md:p-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6"> 
                
                <a id="link-fila-pedidos" href="gestor-pedidos.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-red-100 p-3 sm:p-4 rounded-full mb-4">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Fila de Pedidos</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Veja os pedidos que chegam.</p>
                </a>
                
                <a id="link-cardapio" href="gerenciar-cardapio.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-green-100 p-3 sm:p-4 rounded-full mb-4">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Gerenciar Cardápio</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Adicione itens e categorias.</p> 
                </a>
                
                <a id="link-relatorios" href="pedidos.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-yellow-100 p-3 sm:p-4 rounded-full mb-4">
                         <svg class="w-6 h-6 sm:w-8 sm:h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Relatórios</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Veja o histórico e o faturamento.</p>
                </a>

                <a id="link-avaliacoes" href="avaliacoes.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-orange-100 p-3 sm:p-4 rounded-full mb-4">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.921-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118L2.98 10.1c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                        </svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Avaliações</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Veja o que seus clientes dizem.</p>
                </a>
                
                <a id="link-horarios" href="horarios.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-indigo-100 p-3 sm:p-4 rounded-full mb-4">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Horários</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Defina os horários de funcionamento.</p>
                </a>
                
                <a id="link-taxas" href="taxas-entrega.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-cyan-100 p-3 sm:p-4 rounded-full mb-4"> 
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Taxas de Entrega</h2> 
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Configure os bairros e taxas.</p>
                </a>

                <a id="link-cupons" href="gerenciar-cupons.html" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-orange-100 p-3 sm:p-4 rounded-full mb-4">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                        </svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Gerenciar Cupons</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Criar cupons de desconto.</p>
                </a>
                
                <a id="link-rh" href="/portal-rh/index.html" target="_blank" class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center text-center">
                    <div class="bg-blue-100 p-3 sm:p-4 rounded-full mb-4">
                         <svg class="w-6 h-6 sm:w-8 sm:h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    </div>
                    <h2 class="font-bold text-slate-800">Portal de RH</h2>
                    <p class="text-xs sm:text-sm text-slate-500 mt-1">Equipe, vales e pagamentos.</p>
                </a>
                
            </div>
        </main>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- SCRIPT DO PAINEL DE OPERAÇÕES (v5) ---

        const appContent = document.getElementById('app-content');
        const welcomeMessage = document.getElementById('welcome-message');
        
        // --- Nossos 2 grupos de links ---
        const linkFilaPedidos = document.getElementById('link-fila-pedidos');
        
        // Links de Gestão
        const linksGerente = [
            document.getElementById('link-cardapio'),
            document.getElementById('link-rh'), // Link para o portal-rh
            document.getElementById('link-relatorios'),
            document.getElementById('link-avaliacoes'),
            document.getElementById('link-horarios'),
            document.getElementById('link-taxas'),
            document.getElementById('link-cupons') // <-- ADICIONADO AQUI
        ];
        
        // Esconde todos os links por padrão
        if(linkFilaPedidos) linkFilaPedidos.classList.add('hidden');
        linksGerente.forEach(link => {
            if(link) link.classList.add('hidden');
        });

        
        function initializeApp(userName, userRole) {
            appContent.classList.remove('hidden');
            welcomeMessage.textContent = `Bem-vindo(a), ${userName} (${userRole})!`;

            // --- Lógica de Permissões (Suas Regras) ---

            // Regra 1: Gerente/Admin vê a fila E os links de gestão
            if (userRole === 'admin' || userRole === 'gerente') {
                if(linkFilaPedidos) linkFilaPedidos.classList.remove('hidden');
                linksGerente.forEach(link => {
                    if(link) link.classList.remove('hidden');
                });
            } 
            // Regra 2: Caixa vê SÓ a fila de pedidos
            else if (userRole === 'caixa') {
                 if(linkFilaPedidos) linkFilaPedidos.classList.remove('hidden');
            }
            // Regra 3: Outros (ex: Entregador) não devem usar este painel
            else { 
                welcomeMessage.textContent = `Acesso negado. Use o /portal-rh/ para ver seus dados.`;
            }
        }
        
        // (O resto do JS de checkSession não muda)
        async function checkSession() {
             try {
                const response = await fetch('/usuario_api.php', {credentials: 'include'});
                if (response.ok) {
                    const users = await response.json();
                    if (Array.isArray(users) && users.length > 0 && users[0].nome && users[0].role) { 
                        initializeApp(users[0].nome, users[0].role);
                    } else {
                        window.location.href = '/painel/index.html';
                    }
                } else {
                    window.location.href = '/painel/index.html'; 
                }
            } catch(e) {
                console.error("Erro na verificação de sessão", e);
                window.location.href = '/painel/index.html'; 
            }
        }
        
        checkSession();
    });
</script>
</body>
</html>
